<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puzzle Tones</title>
  <script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script>
  <style>
    body {
      margin: 0;
      background: #1a1a2e;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: monospace;
    }
    h1 { color: #e0e0e0; margin-bottom: 30px; font-size: 1.4rem; letter-spacing: 2px; }
    #puzzle { max-width: 90vw; max-height: 70vh; }
    .piece path { cursor: pointer; transition: filter 0.15s; }
    .piece path:hover { filter: brightness(1.3); }
    .piece.flash path { filter: brightness(1.6); }
    .note-label {
      font-family: monospace;
      font-size: 16px;
      font-weight: bold;
      fill: white;
      text-anchor: middle;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s;
    }
    .piece.flash .note-label { opacity: 1; }
  </style>
</head>
<body>

<h1>Play The Puzzle</h1>
<svg id="puzzle" viewBox="-16 -16 302 302" width="450" height="450"></svg>

<script>
const S = 90, T = 14;
const NOTES = ['C4','D4','E4','F4','G4','A4','B4','C5','D5'];
const COLORS = ['#c0392b','#e67e22','#d4ac0d','#27ae60','#16a085','#2980b9','#8e44ad','#6c5ce7','#e84393'];

function edgePath(x1, y1, x2, y2, type) {
  if (type === 0) return `L ${x2} ${y2}`;
  const mx = (x1 + x2) / 2, my = (y1 + y2) / 2;
  const dx = x2 - x1, dy = y2 - y1;
  const nx = -dy, ny = dx;
  const len = Math.sqrt(nx * nx + ny * ny);
  const d = (type * T) / len;
  const px = mx + nx * d, py = my + ny * d;
  const t1x = x1 + dx * 0.35, t1y = y1 + dy * 0.35;
  const t2x = x1 + dx * 0.65, t2y = y1 + dy * 0.65;
  return `L ${t1x} ${t1y} Q ${px} ${py} ${t2x} ${t2y} L ${x2} ${y2}`;
}

function piecePath(ox, oy, top, right, bottom, left) {
  const x0 = ox, y0 = oy, x1 = ox + S, y1 = oy + S;
  return [
    `M ${x0} ${y0}`,
    edgePath(x0, y0, x1, y0, top),
    edgePath(x1, y0, x1, y1, right),
    edgePath(x1, y1, x0, y1, bottom),
    edgePath(x0, y1, x0, y0, left),
    'Z'
  ].join(' ');
}

const grid = [
  [[ 0, 1, 1, 0],[ 0, 1, 1,-1],[ 0, 0, 1,-1]],
  [[-1, 1, 1, 0],[-1, 1, 1,-1],[-1, 0, 1,-1]],
  [[-1, 1, 0, 0],[-1, 1, 0,-1],[-1, 0, 0,-1]]
];

const svg = document.getElementById('puzzle');
let idx = 0;

for (let r = 0; r < 3; r++) {
  for (let c = 0; c < 3; c++) {
    const [top, right, bottom, left] = grid[r][c];
    const ox = c * S, oy = r * S;
    const note = NOTES[idx];
    const color = COLORS[idx];
    const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    g.classList.add('piece');
    g.dataset.note = note;
    g.innerHTML =
      `<path d="${piecePath(ox, oy, top, right, bottom, left)}" fill="${color}" stroke="#111" stroke-width="1.5"/>` +
      `<text class="note-label" x="${ox + S/2}" y="${oy + S/2 + 6}">${note}</text>`;
    svg.appendChild(g);
    idx++;
  }
}

const reverb = new Tone.Reverb({ decay: 1.5, wet: 0.3 }).toDestination();
const synth = new Tone.Synth({
  oscillator: { type: 'triangle8' },
  envelope: { attack: 0.005, decay: 0.4, sustain: 0, release: 0.4 }
}).connect(reverb);

document.querySelectorAll('.piece').forEach(p => {
  p.addEventListener('click', () => {
    Tone.start();
    synth.triggerAttackRelease(p.dataset.note, '8n');
    p.classList.add('flash');
    setTimeout(() => p.classList.remove('flash'), 400);
  });
});
</script>
</body>
</html>
